{"version":3,"file":"message.js","sources":["../../src/message/message.tsx"],"sourcesContent":["import React from 'react'\nimport ReactDOM from 'react-dom'\nimport classnames from 'classnames'\n\nimport { guid } from '../utils'\nimport {\n  DURATION,\n  MESSAGE_TYPE_CLASSNAME,\n  MESSAGE_TYPE_ICON,\n} from './constants'\n\nimport './message.scss'\nimport '../style/animation/move-50.scss'\nimport { MessageType, OptionProps, MessageProps } from './message.types'\nimport { PREFIX_CLASS } from '../constants'\n\nconst moveUpEnter = 'move-up-enter-50'\nconst moveLeaveEnter = 'move-up-leave-50'\n\nfunction Message({\n  option,\n  type,\n  onClose,\n}: MessageProps & { onClose(): void }) {\n  const thisRef = React.useRef<HTMLDivElement>(null)\n\n  React.useEffect(() => {\n    setTimeout(() => {\n      const notice = thisRef.current\n      notice?.classList.add(moveLeaveEnter)\n    }, option.duration)\n  }, [option.duration])\n\n  React.useEffect(() => {\n    const notice = thisRef.current\n    notice?.addEventListener('animationend', () => {\n      if (notice.classList.contains(moveUpEnter)) {\n        notice.classList.remove(moveUpEnter)\n      } else if (notice.classList.contains(moveLeaveEnter)) {\n        notice.classList.remove(moveLeaveEnter)\n        onClose()\n        if (typeof option.onClose === 'function') {\n          option.onClose()\n        }\n      }\n    })\n  }, [onClose, option, option.onClose])\n\n  return (\n    <div\n      className={classnames(`${PREFIX_CLASS}-message-notice`, moveUpEnter)}\n      ref={thisRef}\n    >\n      <div\n        className={classnames(\n          `${PREFIX_CLASS}-message-notice-content`,\n          MESSAGE_TYPE_CLASSNAME[type],\n          option.className\n        )}\n      >\n        {option.icon\n          ? option.icon\n          : React.createElement(MESSAGE_TYPE_ICON[type], {\n              className: `${PREFIX_CLASS}-message-icon`,\n            })}\n        <span className={`${PREFIX_CLASS}-message-content`}>\n          {option.content}\n        </span>\n      </div>\n    </div>\n  )\n}\n\ntype MessageListItem = MessageProps & { id: string }\n\nconst message = (() => {\n  const container = document.createElement('div')\n  let queue: MessageListItem[] = []\n\n  function renderMessage() {\n    ReactDOM.render(\n      <React.Fragment>\n        {queue.map(message => (\n          <Message\n            {...message}\n            key={message.id}\n            onClose={() => {\n              queue = queue.filter(item => item.id !== message.id)\n              renderMessage()\n            }}\n          />\n        ))}\n      </React.Fragment>,\n      container\n    )\n  }\n\n  function appendMessage(option: OptionProps, type: MessageType) {\n    queue.push({ option, type, id: guid() })\n\n    if (!document.body.contains(container)) {\n      container.className = `${PREFIX_CLASS}-message-container`\n      document.body.appendChild(container)\n    }\n\n    renderMessage()\n  }\n\n  const toast = (type: MessageType) => (\n    content: string,\n    duration: number = DURATION,\n    onClose?: () => void\n  ) => {\n    appendMessage({ content, duration, onClose }, type)\n  }\n\n  return {\n    info: toast(MessageType.Info),\n    success: toast(MessageType.Success),\n    warn: toast(MessageType.Warn),\n    error: toast(MessageType.Error),\n  }\n})()\n\nexport default message\n"],"names":["React","_jsx","PREFIX_CLASS","_jsxs","MESSAGE_TYPE_CLASSNAME","MESSAGE_TYPE_ICON","_createElement","guid","MessageType"],"mappings":"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"}