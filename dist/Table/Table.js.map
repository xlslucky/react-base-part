{"version":3,"file":"Table.js","sources":["../../src/Table/Table.tsx"],"sourcesContent":["import React from 'react'\nimport classnames from 'classnames'\n\nimport { TableProps, ColumnType } from './Table.types'\n\nimport './Table.scss'\nimport Spin from '../Spin'\nimport Checkbox from '../Checkbox/Checkbox'\nimport TableContext, { useTableContext } from './context'\nimport { PREFIX_CLASS } from '../constants'\n\n// 格式化 columns\nconst formatColumns = (columns: ColumnType<any>[]) => {\n  return columns.filter(item => !item.hide)\n}\n\nconst SortableItem = ({\n  item,\n  itemIndex,\n}: {\n  item: any\n  itemIndex: number\n}) => {\n  const {\n    showNo,\n    columns,\n    onRow = () => {},\n    getCount,\n    countRender,\n    showCheckbox,\n    isChecked,\n    isDisabled,\n    onChangeCheckbox,\n  } = useTableContext()\n\n  const count = getCount(itemIndex)\n\n  return (\n    <tr {...onRow(item)}>\n      {showCheckbox && (\n        <td>\n          <Checkbox\n            checked={isChecked ? isChecked(item) : false}\n            disabled={isDisabled ? isDisabled(item) : false}\n            onChange={onChangeCheckbox ? onChangeCheckbox(item) : undefined}\n          />\n        </td>\n      )}\n      {showNo && <td>{countRender(count, item)}</td>}\n      {columns.map((col, i) => {\n        let content = col.dataIndex && item[col.dataIndex]\n        content = col.render ? col.render(content, item, itemIndex) : content\n        return (\n          <td\n            key={col.key || (col.dataIndex as string) || i}\n            style={{ textAlign: col.align || 'left' }}\n          >\n            {content}\n          </td>\n        )\n      })}\n    </tr>\n  )\n}\n\nfunction Table<T extends Record<string, any>>(props: TableProps<T>) {\n  // 切换分页，要从外部重置checkedList\n  const [innerCheckedList, setInnerCheckedList] = React.useState<T[]>([])\n\n  const {\n    dataSource,\n    rowKey,\n    showNo,\n    pagination,\n    loading,\n    description = '暂无数据',\n    onRow,\n    className,\n    countRender = count => count,\n    checkedList,\n    batch,\n    disabledList,\n    prefixCls = PREFIX_CLASS,\n  } = props\n\n  let { columns } = props\n\n  columns = formatColumns(columns)\n\n  React.useEffect(() => {\n    if (\n      typeof checkedList !== 'undefined' &&\n      checkedList.length !== innerCheckedList.length\n    ) {\n      setInnerCheckedList(checkedList)\n    }\n  }, [innerCheckedList.length, checkedList])\n\n  const getCount = React.useCallback(\n    (index: number) => {\n      const pageNo = pagination?.pageNo || 1\n      return pageNo && pagination?.pageSize\n        ? (pageNo - 1) * pagination?.pageSize + index + 1\n        : index + 1\n    },\n    [pagination]\n  )\n\n  const showCheckbox = React.useMemo(() => {\n    return batch && !!rowKey\n  }, [batch, rowKey])\n\n  const countColWidth = React.useMemo(() => {\n    const paddingLeft = !showCheckbox ? 18 : 8\n    const paddingRight = 8\n    const maxCount = getCount(dataSource.length - 1)\n    let num = String(maxCount).length * 10 + paddingLeft + paddingRight\n    if (num < 50) {\n      num = 50\n    }\n    return num\n  }, [dataSource.length, getCount, showCheckbox])\n\n  // 全选是否禁用\n  const isDisabledAll = React.useMemo(() => {\n    return dataSource.length - (disabledList?.length || 0) === 0\n  }, [dataSource.length, disabledList?.length])\n\n  // 全选是否选中\n  const isCheckedAll = React.useMemo(() => {\n    if (isDisabledAll) {\n      return false\n    }\n    return (\n      innerCheckedList.length ===\n      dataSource.length - (disabledList?.length || 0)\n    )\n  }, [\n    innerCheckedList.length,\n    dataSource.length,\n    disabledList?.length,\n    isDisabledAll,\n  ])\n\n  // 复选框是否选中\n  const isChecked = React.useCallback(\n    (item: T) => {\n      if (!rowKey) {\n        return false\n      }\n      return !!innerCheckedList.find(\n        checked => checked[rowKey] === item[rowKey]\n      )\n    },\n    [innerCheckedList, rowKey]\n  )\n\n  // 复选框是否禁用\n  const isDisabled = React.useCallback(\n    (item: T) => {\n      if (!rowKey || !disabledList) {\n        return false\n      }\n      return !!disabledList.find(key => String(key) === String(item[rowKey]))\n    },\n    [disabledList, rowKey]\n  )\n\n  // 复选框选中\n  const onChangeCheckbox = (item: T) => ({\n    target,\n  }: React.ChangeEvent<HTMLInputElement>) => {\n    let list = innerCheckedList.filter(\n      checked => checked[rowKey] !== item[rowKey]\n    )\n    if (target.checked) {\n      list = [...list, item]\n    }\n    setInnerCheckedList(list)\n    if (props.onChangeCheckbox) {\n      props.onChangeCheckbox(list)\n    }\n  }\n\n  // 全选\n  const onChangeCheckboxAll = ({\n    target,\n  }: React.ChangeEvent<HTMLInputElement>) => {\n    let list: T[] = []\n    if (target.checked) {\n      if (disabledList && rowKey) {\n        list = dataSource.filter(\n          item => !disabledList.map(String).includes(String(item[rowKey]))\n        )\n      } else {\n        list = dataSource\n      }\n    }\n    setInnerCheckedList(list)\n    if (props.onChangeCheckbox) {\n      props.onChangeCheckbox(list)\n    }\n  }\n\n  const renderTable = () => {\n    const narrowTable = showNo\n\n    return (\n      <TableContext.Provider\n        value={{\n          countRender,\n          getCount,\n          showNo,\n          columns,\n          onRow,\n          showCheckbox,\n          isChecked,\n          isDisabled,\n          onChangeCheckbox,\n        }}\n      >\n        <table\n          className={classnames({ [`${prefixCls}-table-narrow`]: narrowTable })}\n        >\n          <colgroup>\n            {showCheckbox && <col width={50} />}\n            {showNo && <col width={countColWidth} />}\n            {columns.map((item, index) => (\n              <col\n                key={item.key || (item.dataIndex as string) || index}\n                width={item.width}\n              />\n            ))}\n          </colgroup>\n          <thead>\n            <tr>\n              {showCheckbox && (\n                <th>\n                  <Checkbox\n                    disabled={isDisabledAll}\n                    checked={isCheckedAll}\n                    onChange={onChangeCheckboxAll}\n                  />\n                </th>\n              )}\n              {showNo && <th />}\n              {columns.map((item, index) => (\n                <th\n                  key={item.key || (item.dataIndex as string) || index}\n                  style={{ textAlign: item.align || 'left' }}\n                >\n                  {item.title}\n                </th>\n              ))}\n            </tr>\n          </thead>\n          <tbody>\n            {dataSource.map((item, index) => {\n              const key = rowKey ? item[rowKey] : index\n              return <SortableItem key={key} itemIndex={index} item={item} />\n            })}\n          </tbody>\n        </table>\n      </TableContext.Provider>\n    )\n  }\n\n  return (\n    <Spin\n      loading={loading}\n      empty={!dataSource.length}\n      description={description}\n      pagination={pagination}\n    >\n      <div className={classnames(`${prefixCls}-table-container`, className)}>\n        {renderTable()}\n      </div>\n    </Spin>\n  )\n}\n\nexport default Table\n"],"names":["useTableContext","_jsxs","_jsx","Checkbox","React","PREFIX_CLASS","TableContext","Spin"],"mappings":"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"}