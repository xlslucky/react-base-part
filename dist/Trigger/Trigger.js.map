{"version":3,"file":"Trigger.js","sources":["../../src/Trigger/Trigger.tsx"],"sourcesContent":["import React from 'react'\n\nimport { TriggerProps } from './Trigger.types'\n\nimport useTriggerStyle from './useTriggerStyle'\nimport useClickAway from '../hooks/useClickAway'\nimport Portal from '../utils/Portal'\n\nimport './Trigger.scss'\nimport { PREFIX_CLASS } from '../constants'\n\nconst Trigger: React.FC<TriggerProps> = ({\n  children,\n  placement,\n  destroyPopupOnHide = false,\n  trigger,\n  popup,\n  getPopupContainer = () => document.body,\n  enterClassName,\n  leaveClassName,\n  offset,\n  stretch,\n  clickPopupClose,\n  zIndex,\n  prefixCls = PREFIX_CLASS,\n}) => {\n  const [innerVisible, setVisible] = React.useState(false)\n  const [showOverlay, setShowOverlay] = React.useState(false)\n\n  const childrenRef = React.useRef<HTMLElement>(null)\n  const popupRef = React.useRef<HTMLDivElement>(null)\n\n  const HIDDEN_CLASS_NAME = `${prefixCls}-trigger-hidden`\n  const OPACITY_ZERO_CLASS_NAME = `${prefixCls}-trigger-opacity-zero`\n\n  const container = getPopupContainer()\n\n  const finalVisible = React.useMemo(() => {\n    return innerVisible\n  }, [innerVisible])\n\n  function updateVisible(nextVisible: boolean) {\n    setVisible(nextVisible)\n  }\n\n  // 点击子元素、浮层以外元素 关闭浮层\n  useClickAway([childrenRef, popupRef], () => {\n    updateVisible(false)\n  })\n\n  React.useEffect(() => {\n    if (finalVisible) {\n      setShowOverlay(true)\n    }\n  }, [finalVisible])\n\n  React.useEffect(() => {\n    const node = popupRef.current\n    function popupAnimationend({ target }: any) {\n      if (!enterClassName || !leaveClassName) {\n        return\n      }\n      // 进入动画结束，删除进入动画className\n      if (target.classList.contains(enterClassName)) {\n        target.classList.remove(enterClassName)\n      }\n      // 离开动画结束，删除离开动画className并添加隐藏className\n      if (target.classList.contains(leaveClassName)) {\n        target.classList.remove(leaveClassName)\n        target.classList.add(HIDDEN_CLASS_NAME)\n        // 销毁dom\n        if (destroyPopupOnHide) {\n          setShowOverlay(false)\n        }\n      }\n    }\n    if (showOverlay) {\n      node?.addEventListener('animationend', popupAnimationend)\n    }\n    return () => {\n      node?.removeEventListener('animationend', popupAnimationend)\n    }\n  }, [\n    HIDDEN_CLASS_NAME,\n    destroyPopupOnHide,\n    enterClassName,\n    leaveClassName,\n    showOverlay,\n  ])\n\n  React.useEffect(() => {\n    if (container) {\n      if (\n        !['relative', 'absolute', 'fixed'].includes(\n          window.getComputedStyle(container, null).position\n        )\n      ) {\n        container.style.position = 'relative'\n      }\n    }\n  }, [container])\n\n  const { triggerStyle, calcStyleEnd } = useTriggerStyle({\n    finalVisible,\n    placement,\n    childrenRef,\n    popupRef,\n    container,\n    offset,\n    stretch,\n  })\n\n  React.useEffect(() => {\n    if (finalVisible) {\n      const node = popupRef.current\n      node?.classList.remove(HIDDEN_CLASS_NAME)\n      if (enterClassName && leaveClassName) {\n        /**\n         * fix: 加动画className 第二次划过会闪动\n         * solve: 如果有动画 加个opacity: 0 的样式 等到动画加载出来再删除\n         */\n        node?.classList.add(OPACITY_ZERO_CLASS_NAME)\n        if (calcStyleEnd) {\n          // 删除离开动画，添加进入动画\n          node?.classList.remove(leaveClassName)\n          node?.classList.add(enterClassName)\n          node?.classList.remove(OPACITY_ZERO_CLASS_NAME)\n        }\n      }\n    } else {\n      const node = popupRef.current\n      if (leaveClassName && enterClassName) {\n        // 删除进入动画，添加离开动画\n        node?.classList.remove(enterClassName)\n        node?.classList.add(leaveClassName)\n      } else {\n        // 没设置动画 直接隐藏\n        node?.classList.add(HIDDEN_CLASS_NAME)\n      }\n    }\n  }, [\n    HIDDEN_CLASS_NAME,\n    OPACITY_ZERO_CLASS_NAME,\n    calcStyleEnd,\n    enterClassName,\n    finalVisible,\n    leaveClassName,\n  ])\n\n  /**\n   * 点击子元素 切换显示、隐藏状态\n   *\n   * 废弃：使用clickPopupClose传参控制\n   * // 如需点击浮层不关闭，在 popup 上写 onClick={e => e.stopPropagation()} 即可\n   */\n  function onClick(event: React.MouseEvent<HTMLDivElement, MouseEvent>) {\n    const { props } = children\n    /**\n     * fix: 子元素loading | disabled 状态不允许点击\n     * solve: loading | disabled 直接return\n     */\n    if (props.loading || props.disabled) {\n      return\n    }\n    if (typeof props.onClick === 'function') {\n      children.props.onClick(event)\n    }\n    if (trigger.includes('click')) {\n      updateVisible(!finalVisible)\n    }\n  }\n\n  // 点击浮层\n  function onClickPopup() {\n    if (clickPopupClose) {\n      updateVisible(!finalVisible)\n    }\n  }\n\n  function onMouseEnter(event: React.MouseEvent<HTMLDivElement, MouseEvent>) {\n    if (typeof children.props.onMouseEnter === 'function') {\n      children.props.onMouseEnter(event)\n    }\n    if (trigger.includes('hover')) {\n      updateVisible(true)\n    }\n  }\n\n  function onMouseLeave(event: React.MouseEvent<HTMLDivElement, MouseEvent>) {\n    if (typeof children.props.onMouseLeave === 'function') {\n      children.props.onMouseLeave(event)\n    }\n    if (trigger.includes('hover')) {\n      updateVisible(false)\n    }\n  }\n\n  const showPortal = finalVisible || showOverlay\n\n  return (\n    <React.Fragment>\n      {React.cloneElement(children, {\n        ref: childrenRef,\n        onClick,\n        onMouseEnter,\n        onMouseLeave,\n      })}\n      {showPortal ? (\n        <Portal getContainer={() => container}>\n          <div className={`${prefixCls}-trigger-portal`} style={{ zIndex }}>\n            <div\n              onClick={onClickPopup}\n              onMouseEnter={onMouseEnter}\n              onMouseLeave={onMouseLeave}\n              ref={popupRef}\n              style={triggerStyle}\n              className={`${prefixCls}-trigger-container`}\n            >\n              {popup}\n            </div>\n          </div>\n        </Portal>\n      ) : null}\n    </React.Fragment>\n  )\n}\n\nexport default Trigger\n"],"names":["PREFIX_CLASS","React","_jsxs","_jsx"],"mappings":"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"}