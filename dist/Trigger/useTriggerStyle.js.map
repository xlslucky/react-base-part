{"version":3,"file":"useTriggerStyle.js","sources":["../../src/Trigger/useTriggerStyle.ts"],"sourcesContent":["import React from 'react'\nimport { PlacementType, OffsetType, StretchType } from './Trigger.types'\n\nimport { getBaseStyle, getFullStyle } from './utils'\n\ninterface Props {\n  placement: PlacementType\n  finalVisible: boolean\n  childrenRef: React.RefObject<HTMLElement>\n  popupRef: React.RefObject<HTMLDivElement>\n  container: HTMLElement\n  offset?: OffsetType\n  stretch?: StretchType\n}\n\nfunction useTriggerStyle({\n  placement,\n  finalVisible,\n  childrenRef,\n  popupRef,\n  container,\n  offset,\n  stretch,\n}: Props) {\n  const [triggerStyle, setTriggerStyle] = React.useState<React.CSSProperties>({\n    display: 'block',\n    visibility: 'hidden',\n  })\n  // 计算属性后，加动画，不然popup高度，宽度计算不准确\n  const [calcStyleEnd, setCalcStyleEnd] = React.useState(false)\n\n  const [childrenFullLeft, childrenFullTop] = React.useMemo(() => {\n    // 需要加visible 不然childrenRef不更新\n    if (!finalVisible || !childrenRef.current) {\n      return [0, 0]\n    }\n    const {\n      left: childrenLeft,\n      top: childrenTop,\n    } = childrenRef.current.getBoundingClientRect()\n    const {\n      left: containerLeft,\n      top: containerTop,\n    } = container.getBoundingClientRect()\n    const {\n      scrollTop: containerScrollTop,\n      scrollLeft: containerScrollLeft,\n    } = container\n    const fullTop = Math.round(childrenTop - containerTop + containerScrollTop)\n    const fullLeft = Math.round(\n      childrenLeft - containerLeft + containerScrollLeft\n    )\n    return [fullLeft, fullTop]\n  }, [childrenRef, container, finalVisible])\n\n  const getTriggerStyle = React.useCallback((): React.CSSProperties => {\n    if (!childrenRef.current || !popupRef.current) {\n      return {}\n    }\n    const {\n      width: childrenWidth,\n      height: childrenHeight,\n    } = childrenRef.current.getBoundingClientRect()\n    const {\n      width: PopupWidth,\n      height: PopupHeight,\n    } = popupRef.current.getBoundingClientRect()\n    const baseStyle = getBaseStyle({\n      placement,\n      childrenFullLeft,\n      childrenFullTop,\n      childrenHeight,\n      childrenWidth,\n      PopupHeight,\n      PopupWidth,\n    })\n    const style = getFullStyle({\n      style: baseStyle,\n      offset,\n      stretch,\n      childrenHeight,\n      childrenWidth,\n    })\n    return style\n  }, [\n    childrenRef,\n    popupRef,\n    placement,\n    childrenFullLeft,\n    childrenFullTop,\n    offset,\n    stretch,\n  ])\n\n  React.useEffect(() => {\n    if (finalVisible) {\n      setTimeout(() => {\n        // setTimeout 为了childrenRef.current和popupRef.current能取到值\n        setTriggerStyle(getTriggerStyle())\n        setCalcStyleEnd(true)\n      }, 0)\n    } else {\n      setCalcStyleEnd(false)\n    }\n  }, [getTriggerStyle, finalVisible])\n\n  return { triggerStyle, calcStyleEnd }\n}\n\nexport default useTriggerStyle\n"],"names":["React","getBaseStyle","getFullStyle"],"mappings":"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"}